<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maritime Operations Dashboard Wizard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .step-indicator {
            transition: all 0.3s ease;
        }
        .step-active {
            background: linear-gradient(135deg, #3B82F6, #1E40AF);
            transform: scale(1.1);
        }
        .step-completed {
            background: linear-gradient(135deg, #10B981, #059669);
        }
        .dashboard-card {
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .kpi-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .kpi-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .progress-bar-animated {
            background: linear-gradient(90deg, #10B981, #34D399, #6EE7B7);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        .wizard-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .dashboard-container {
            background: linear-gradient(135deg, #e0f2f7 0%, #a5d8ef 100%);
            color: #374151;
            min-height: 100vh;
        }
        @media (max-width: 768px) {
            .dashboard-card {
                margin: 0.5rem;
                padding: 1rem;
            }
            .wizard-container {
                padding: 1rem 0;
            }
            .step-indicator {
                font-size: 0.875rem;
            }
        }
    </style>
</head>
<body>
    <!-- Wizard Interface -->
    <div id="wizardInterface" class="wizard-container">
        <div class="container mx-auto px-4 py-8">
            <!-- Header -->
            <div class="text-center mb-8 lg:mb-12">
                <h1 class="text-2xl lg:text-4xl font-bold text-white mb-4">
                    <i class="fas fa-ship mr-2 lg:mr-3"></i>Maritime Operations Dashboard Wizard
                </h1>
                <p class="text-base lg:text-xl text-blue-100">Create custom live dashboards for your vessel operations</p>
            </div>

            <!-- Document Upload Section -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8 max-w-4xl mx-auto">
                <h2 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                    <i class="fas fa-cloud-upload-alt text-blue-600 mr-3"></i>Upload Maritime Documents (Optional)
                </h2>
                <p class="text-gray-600 mb-4">Upload vessel operation documents to automatically populate form fields below</p>
                <div class="flex items-center justify-center w-full">
                    <label for="wizardDocumentUpload" class="flex flex-col items-center justify-center w-full h-32 border-2 border-blue-300 border-dashed rounded-lg cursor-pointer bg-blue-50 hover:bg-blue-100 transition-colors duration-200">
                        <div class="flex flex-col items-center justify-center pt-5 pb-6">
                            <i class="fas fa-file-upload text-2xl text-blue-500 mb-2"></i>
                            <p class="mb-2 text-sm text-gray-500"><span class="font-semibold">Click to upload</span> or drag and drop</p>
                            <p class="text-xs text-gray-500">PDF, CSV, or TXT files (Max 16MB)</p>
                        </div>
                        <input id="wizardDocumentUpload" type="file" class="hidden" accept=".pdf,.csv,.txt" onchange="handleWizardFileUpload(event)">
                    </label>
                </div>
                <div id="wizardUploadStatus" class="mt-4 hidden">
                    <div class="flex items-center justify-center">
                        <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500 mr-3"></div>
                        <span class="text-blue-600">Processing document...</span>
                    </div>
                </div>
                <div id="wizardUploadSuccess" class="mt-4 hidden">
                    <div class="flex items-center justify-center text-green-600">
                        <i class="fas fa-check-circle mr-2"></i>
                        <span>Document processed successfully! Form fields have been populated.</span>
                    </div>
                </div>
                <div id="wizardUploadError" class="mt-4 hidden">
                    <div class="flex items-center justify-center text-red-600">
                        <i class="fas fa-exclamation-circle mr-2"></i>
                        <span id="wizardUploadErrorText">Error processing document. Please try again.</span>
                    </div>
                </div>
            </div>

            <!-- Step Indicator -->
            <div class="flex justify-center mb-8 px-4">
                <div class="flex items-center space-x-2 md:space-x-4 overflow-x-auto">
                    <div id="step1-indicator" class="step-indicator step-active w-10 h-10 md:w-12 md:h-12 rounded-full flex items-center justify-center text-white font-bold text-sm md:text-base">1</div>
                    <div class="w-8 md:w-16 h-1 bg-blue-300"></div>
                    <div id="step2-indicator" class="step-indicator w-10 h-10 md:w-12 md:h-12 rounded-full bg-blue-300 flex items-center justify-center text-white font-bold text-sm md:text-base">2</div>
                    <div class="w-8 md:w-16 h-1 bg-blue-300"></div>
                    <div id="step3-indicator" class="step-indicator w-10 h-10 md:w-12 md:h-12 rounded-full bg-blue-300 flex items-center justify-center text-white font-bold text-sm md:text-base">3</div>
                    <div class="w-8 md:w-16 h-1 bg-blue-300"></div>
                    <div id="step4-indicator" class="step-indicator w-10 h-10 md:w-12 md:h-12 rounded-full bg-blue-300 flex items-center justify-center text-white font-bold text-sm md:text-base">4</div>
                </div>
            </div>

            <!-- Step 1: Vessel Information -->
            <div id="step1" class="dashboard-card rounded-2xl p-8 shadow-2xl mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-ship text-blue-600 mr-3"></i>Vessel Information
                </h2>

                <!-- Document Upload Section -->
                <div class="mb-8 p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border-2 border-dashed border-blue-300">
                    <div class="text-center">
                        <i class="fas fa-cloud-upload-alt text-4xl text-blue-500 mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">Quick Fill from Document</h3>
                        <p class="text-gray-600 mb-4">Upload a maritime document (PDF, CSV, or TXT) to automatically populate the form</p>

                        <div class="flex items-center justify-center w-full">
                            <label for="documentUpload" class="flex flex-col items-center justify-center w-full h-32 border-2 border-blue-300 border-dashed rounded-lg cursor-pointer bg-blue-50 hover:bg-blue-100 transition-colors duration-200">
                                <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                    <i class="fas fa-file-upload text-2xl text-blue-500 mb-2"></i>
                                    <p class="mb-2 text-sm text-gray-500"><span class="font-semibold">Click to upload</span> or drag and drop</p>
                                    <p class="text-xs text-gray-500">PDF, CSV, or TXT files (Max 16MB)</p>
                                </div>
                                <input id="documentUpload" type="file" class="hidden" accept=".pdf,.csv,.txt" onchange="handleFileUpload(event)">
                            </label>
                        </div>

                        <div id="uploadStatus" class="mt-4 hidden">
                            <div class="flex items-center justify-center">
                                <div id="uploadSpinner" class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500 mr-3"></div>
                                <span id="uploadText" class="text-blue-600">Processing document...</span>
                            </div>
                        </div>

                        <div id="uploadSuccess" class="mt-4 hidden">
                            <div class="flex items-center justify-center text-green-600">
                                <i class="fas fa-check-circle mr-2"></i>
                                <span>Document processed successfully! Form has been auto-filled.</span>
                            </div>
                        </div>

                        <div id="uploadError" class="mt-4 hidden">
                            <div class="flex items-center justify-center text-red-600">
                                <i class="fas fa-exclamation-circle mr-2"></i>
                                <span id="errorText">Error processing document. Please try again.</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stevedore Team Assignment Section -->
                <div class="mb-8 p-6 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border-2 border-green-200">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-users text-2xl text-green-600 mr-3"></i>
                        <h3 class="text-xl font-semibold text-gray-800">Stevedore Team Assignment</h3>
                    </div>
                    <p class="text-gray-600 mb-4">Assign team members to different operation roles for this vessel</p>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6">
                        <!-- Auto Operations Team -->
                        <div class="bg-white p-3 lg:p-4 rounded-lg border border-green-200">
                            <h4 class="font-semibold text-gray-800 mb-3 flex items-center text-sm lg:text-base">
                                <i class="fas fa-car text-blue-500 mr-2"></i>Auto Operations Team
                            </h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-xs lg:text-sm font-medium text-gray-700 mb-1">Lead Supervisor</label>
                                    <input type="text" id="autoOpsLead" class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm" placeholder="e.g., Colby Chapman">
                                </div>
                                <div>
                                    <label class="block text-xs lg:text-sm font-medium text-gray-700 mb-1">Assistant Supervisor</label>
                                    <input type="text" id="autoOpsAssistant" class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm" placeholder="e.g., Cole Bailey">
                                </div>
                            </div>
                        </div>

                        <!-- High & Heavy Team -->
                        <div class="bg-white p-3 lg:p-4 rounded-lg border border-green-200">
                            <h4 class="font-semibold text-gray-800 mb-3 flex items-center text-sm lg:text-base">
                                <i class="fas fa-truck text-orange-500 mr-2"></i>High & Heavy Team
                            </h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-xs lg:text-sm font-medium text-gray-700 mb-1">Lead Supervisor</label>
                                    <input type="text" id="heavyOpsLead" class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm" placeholder="e.g., Spencer Wilkins">
                                </div>
                                <div>
                                    <label class="block text-xs lg:text-sm font-medium text-gray-700 mb-1">Assistant Supervisor</label>
                                    <input type="text" id="heavyOpsAssistant" class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm" placeholder="e.g., Bruce Banner">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Team Roles -->
                    <div class="mt-4 grid md:grid-cols-2 gap-6">
                        <div class="bg-white p-4 rounded-lg border border-green-200">
                            <h4 class="font-semibold text-gray-800 mb-3 flex items-center">
                                <i class="fas fa-anchor text-purple-500 mr-2"></i>Berth Assignment
                            </h4>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Berth Location</label>
                                <select id="berthLocation" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                    <option value="">Select Berth</option>
                                    <option value="Berth 1">Berth 1</option>
                                    <option value="Berth 2">Berth 2</option>
                                    <option value="Berth 3">Berth 3</option>
                                </select>
                            </div>
                        </div>

                        <div class="bg-white p-4 rounded-lg border border-green-200">
                            <h4 class="font-semibold text-gray-800 mb-3 flex items-center">
                                <i class="fas fa-user-tie text-indigo-500 mr-2"></i>Operation Manager
                            </h4>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Your Name</label>
                                <input type="text" id="operationManager" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="Enter your name">
                            </div>
                        </div>
                    </div>
                </div>

                <form id="operationForm">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Vessel Name</label>
                        <input type="text" id="vesselName" name="vesselName" class="w-full px-3 py-2 lg:px-4 lg:py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm lg:text-base" placeholder="e.g., Donington 38">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Shipping Line</label>
                        <select id="shippingLine" name="shippingLine" class="w-full px-3 py-2 lg:px-4 lg:py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm lg:text-base" onchange="updateCargoConfiguration()">
                            <option value="">Select Shipping Line</option>
                            <option value="K-Line">K-Line</option>
                            <option value="MOL">MOL</option>
                            <option value="Glovis">Glovis</option>
                            <option value="Grimaldi">Grimaldi</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Vessel Type</label>
                        <select id="vesselType" name="vesselType" class="w-full px-3 py-2 lg:px-4 lg:py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm lg:text-base" onchange="updateCargoConfiguration()">
                            <option value="">Select Vessel Type</option>
                            <option value="Auto Only">Auto Only</option>
                            <option value="Heavy Only">Heavy Only</option>
                            <option value="Auto + Heavy">Auto + Heavy</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Port</label>
                        <input type="text" id="port" name="port" class="w-full px-3 py-2 lg:px-4 lg:py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm lg:text-base" value="Colonel Island" list="portOptions">
                        <datalist id="portOptions">
                            <option value="Colonel Island">
                            <option value="Brunswick, GA">
                            <option value="Baltimore, MD">
                            <option value="Jacksonville, FL">
                        </datalist>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Operation Date</label>
                        <input type="date" id="operationDate" name="operationDate" class="w-full px-3 py-2 lg:px-4 lg:py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm lg:text-base">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Stevedoring Company</label>
                        <input type="text" id="company" name="company" class="w-full px-3 py-2 lg:px-4 lg:py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm lg:text-base" value="APS Stevedoring" list="companyOptions">
                        <datalist id="companyOptions">
                            <option value="APS Stevedoring">
                            <option value="SSA Marine">
                            <option value="Ports America">
                        </datalist>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Operation Type</label>
                        <select id="operationType" name="operationType" class="w-full px-3 py-2 lg:px-4 lg:py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm lg:text-base">
                            <option value="">Select Operation</option>
                            <option value="Discharge Only">Discharge Only</option>
                            <option value="Loading Only">Loading Only</option>
                            <option value="Discharge + Loading">Discharge + Loading</option>
                        </select>
                    </div>
                </div>
                <div class="flex justify-end mt-6 lg:mt-8">
                    <button type="button" onclick="nextStep(1)" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 lg:px-8 lg:py-3 rounded-lg font-semibold transition duration-200 text-sm lg:text-base">
                        Next <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>

            <!-- Step 2: Cargo Configuration -->
            <div id="step2" class="dashboard-card rounded-2xl p-8 shadow-2xl mb-8 hidden">
                <h2 class="text-3xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-car text-green-600 mr-3"></i>Cargo Configuration
                </h2>
                <p class="text-gray-600 mb-6">Configure cargo breakdown by terminal and facility location</p>

                <!-- K-Line Configuration -->
                <div id="klineConfiguration" class="hidden">
                    <!-- BRV Section -->
                    <div class="mt-8 p-6 bg-blue-50 rounded-lg border border-blue-200">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-warehouse text-blue-600 mr-2"></i>BRV Terminal
                        </h3>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="auto-only-field auto-heavy-field">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Total Autos</label>
                                <input type="number" id="brvAutomobiles" name="brvAutomobiles" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="e.g., 500" onchange="validateBrvTotals()">
                            </div>
                            <div class="auto-only-field auto-heavy-field col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Vehicle Type, Quantity & Location</label>
                                <div id="brvVehicleTypes">
                                    <button type="button" onclick="addVehicleType('brv')" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded mb-4">Add Vehicle Type</button>
                                    <div id="brvVehicleTypeContainer"></div>
                                </div>
                            </div>
                            <div class="heavy-only-field auto-heavy-field">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Total Heavy</label>
                                <input type="number" id="brvHeavyEquipment" name="brvHeavyEquipment" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="e.g., 25">
                            </div>
                            <div class="heavy-only-field auto-heavy-field">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Heavy Vehicle Type & Quantity</label>
                                <textarea id="brvHeavyTypes" name="brvHeavyTypes" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="e.g., Excavator: 10, Bulldozer: 15" rows="2"></textarea>
                            </div>
                            <div class="auto-only-field auto-heavy-field">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Electric Vehicles</label>
                                <div class="flex items-center space-x-4 mb-2">
                                    <label class="flex items-center">
                                        <input type="radio" name="brvHasElectric" value="yes" class="mr-2" onchange="toggleElectricQuantity('brv', true)">
                                        <span>Yes</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="brvHasElectric" value="no" class="mr-2" onchange="toggleElectricQuantity('brv', false)" checked>
                                        <span>No</span>
                                    </label>
                                </div>
                                <input type="number" id="brvTotalElectric" name="brvTotalElectric" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="e.g., 15" style="display: none;">
                            </div>
                            
                        </div>
                    </div>

                    <!-- ZEE Section -->
                    <div class="mt-8 p-6 bg-green-50 rounded-lg border border-green-200">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-warehouse text-green-600 mr-2"></i>ZEE Compound
                        </h3>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="auto-only-field auto-heavy-field">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Total Autos</label>
                                <input type="number" id="zeeTotalAutos" name="zeeTotalAutos" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="e.g., 300">
                            </div>
                            <div class="auto-only-field auto-heavy-field col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Vehicle Type, Quantity & Location</label>
                                <div id="zeeVehicleTypesContainer">
                                    <button type="button" onclick="addVehicleType('zee')" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded mb-4">Add Vehicle Type</button>
                                    <div id="zeeVehicleTypeContainer"></div>
                                </div>
                            </div>
                            <div class="heavy-only-field auto-heavy-field">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Total Heavy</label>
                                <input type="number" id="zeeTotalHeavy" name="zeeTotalHeavy" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="e.g., 20">
                            </div>
                            <div class="heavy-only-field auto-heavy-field">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Heavy Vehicle Type & Quantity</label>
                                <textarea id="zeeHeavyTypes" name="zeeHeavyTypes" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="e.g., Crane: 5, Loader: 15" rows="2"></textarea>
                            </div>
                            <div class="auto-only-field auto-heavy-field">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Electric Vehicles</label>
                                <div class="flex items-center space-x-4 mb-2">
                                    <label class="flex items-center">
                                        <input type="radio" name="zeeHasElectric" value="yes" class="mr-2" onchange="toggleElectricQuantity('zee', true)">
                                        <span>Yes</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="zeeHasElectric" value="no" class="mr-2" onchange="toggleElectricQuantity('zee', false)" checked>
                                        <span>No</span>
                                    </label>
                                </div>
                                <input type="number" id="zeeElectricVehicles" name="zeeElectricVehicles" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="e.g., 25" style="display: none;">
                            </div>
                            
                        </div>
                    </div>

                    <!-- SOU Section -->
                    <div class="mt-8 p-6 bg-purple-50 rounded-lg border border-purple-200">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-warehouse text-purple-600 mr-2"></i>SOU Facility
                        </h3>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="auto-only-field auto-heavy-field">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Total Autos</label>
                                <input type="number" id="souTotalAutos" name="souTotalAutos" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="e.g., 200">
                            </div>
                            <div class="auto-only-field auto-heavy-field col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Vehicle Type, Quantity & Location</label>
                                <div id="souVehicleTypesContainer">
                                    <button type="button" onclick="addVehicleType('sou')" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded mb-4">Add Vehicle Type</button>
                                    <div id="souVehicleTypeContainer"></div>
                                </div>
                            </div>
                            <div class="heavy-only-field auto-heavy-field">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Total Heavy</label>
                                <input type="number" id="souHeavyEquipment" name="souHeavyEquipment" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="e.g., 15">
                            </div>
                            <div class="heavy-only-field auto-heavy-field">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Heavy Vehicle Type & Quantity</label>
                                <textarea id="souHeavyTypes" name="souHeavyTypes" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="e.g., Forklift: 10, Generator: 5" rows="2"></textarea>
                            </div>
                            <div class="auto-only-field auto-heavy-field">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Electric Vehicles</label>
                                <div class="flex items-center space-x-4 mb-2">
                                    <label class="flex items-center">
                                        <input type="radio" name="souHasElectric" value="yes" class="mr-2" onchange="toggleElectricQuantity('sou', true)">
                                        <span>Yes</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="souHasElectric" value="no" class="mr-2" onchange="toggleElectricQuantity('sou', false)" checked>
                                        <span>No</span>
                                    </label>
                                </div>
                                <input type="number" id="souTotalElectric" name="souTotalElectric" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="e.g., 10" style="display: none;">
                            </div>
                            
                        </div>
                    </div>
                </div>

                <!-- Single Terminal Configuration for Glovis, MOL, Grimaldi -->
                <div id="singleTerminalConfiguration" class="hidden">
                    <!-- Single Terminal Section -->
                    <div class="mt-8 p-6 bg-yellow-50 rounded-lg border border-yellow-200">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-boxes text-yellow-600 mr-2"></i>Terminal Facility
                        </h3>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="auto-only-field auto-heavy-field">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Total Automobiles</label>
                                <input type="number" id="terminalAutomobiles" name="terminalAutomobiles" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-yellow-500 focus:border-transparent" placeholder="e.g., 400">
                            </div>
                            <div class="auto-only-field auto-heavy-field">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Vehicle Type & Quantity</label>
                                <div id="terminalVehicleTypes">
                                    <button type="button" onclick="addVehicleType('terminal')" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">Add Vehicle Type</button>
                                    <div id="terminalVehicleTypeContainer"></div>
                                </div>
                            </div>
                            <div class="heavy-only-field auto-heavy-field">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Total Heavy</label>
                                <input type="number" id="terminalHeavyEquipment" name="terminalHeavyEquipment" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-yellow-500 focus:border-transparent" placeholder="e.g., 30">
                            </div>
                            <div class="heavy-only-field auto-heavy-field">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Heavy Vehicle Type & Quantity</label>
                                <textarea id="terminalHeavyTypes" name="terminalHeavyTypes" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-yellow-500 focus:border-transparent" placeholder="e.g., Tractor: 10, Trailer: 20" rows="2"></textarea>
                            </div>
                            <div class="auto-only-field auto-heavy-field">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Electric Vehicles</label>
                                <div class="flex items-center space-x-4 mb-2">
                                    <label class="flex items-center">
                                        <input type="radio" name="terminalHasElectric" value="yes" class="mr-2" onchange="toggleElectricQuantity('terminal', true)">
                                        <span>Yes</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="terminalHasElectric" value="no" class="mr-2" onchange="toggleElectricQuantity('terminal', false)" checked>
                                        <span>No</span>
                                    </label>
                                </div>
                                <input type="number" id="terminalElectricVehicles" name="terminalElectricVehicles" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-yellow-500 focus:border-transparent" placeholder="e.g., 30" style="display: none;">
                            </div>
                            <div class="heavy-only-field auto-heavy-field">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Total Static Cargo</label>
                                <input type="number" id="terminalStaticCargo" name="terminalStaticCargo" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-yellow-500 focus:border-transparent" placeholder="e.g., 20">
                            </div>
                            
                        </div>
                    </div>
                </div>

                <div class="flex justify-between mt-8">
                    <button type="button" onclick="prevStep(2)" class="bg-gray-500 hover:bg-gray-600 text-white px-8 py-3 rounded-lg font-semibold transition duration-200">
                        <i class="fas fa-arrow-left mr-2"></i>Previous
                    </button>
                    <button type="button" onclick="nextStep(2)" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg font-semibold transition duration-200">
                        Next <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>

            <!-- Step 3: Operational Parameters -->
            <div id="step3" class="dashboard-card rounded-2xl p-8 shadow-2xl mb-8 hidden">
                <h2 class="text-3xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-cogs text-purple-600 mr-3"></i>Operational Parameters
                </h2>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Expected Rate (cars/hour)</label>
                        <input type="number" step="0.1" id="expectedRate" name="expectedRate" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="e.g., 120.5">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Total Drivers</label>
                        <input type="number" id="totalDrivers" name="totalDrivers" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="e.g., 77">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Shift Start Time</label>
                        <input type="time" id="shiftStart" name="shiftStart" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Shift End Time</label>
                        <input type="time" id="shiftEnd" name="shiftEnd" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Break Duration (minutes)</label>
                        <input type="number" id="breakDuration" name="breakDuration" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="e.g., 60">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Target Completion</label>
                        <input type="datetime-local" id="targetCompletion" name="targetCompletion" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                </div>

                <!-- TICO Transportation Section -->
                <div class="mt-8 p-6 bg-blue-50 rounded-lg border border-blue-200">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-shuttle-van text-blue-600 mr-2"></i>TICO Transportation
                    </h3>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Number of Vans (7 drivers each)</label>
                            <select id="numVans" name="numVans" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent" onchange="generateVehicleIdFields()">
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="13">13</option>
                                <option value="14">14</option>
                                <option value="15">15</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Number of Station Wagons (5 drivers each)</label><select id="numStationWagons" name="numStationWagons" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent" onchange="generateVehicleIdFields()">
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="13">13</option>
                                <option value="14">14</option>
                                <option value="15">15</option>
                            </select>
                        </div>
                    </div>

                    <!-- Dynamic Vehicle ID Fields -->
                    <div id="vehicleIdFields" class="mt-6">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
                <div class="flex justify-between mt-8">
                    <button type="button" onclick="prevStep(3)" class="bg-gray-500 hover:bg-gray-600 text-white px-8 py-3 rounded-lg font-semibold transition duration-200">
                        <i class="fas fa-arrow-left mr-2"></i>Previous
                    </button>
                    <button type="button" onclick="nextStep(3)" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg font-semibold transition duration-200">
                        Next <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>

            <!-- Step 4: Review & Generate -->
            <div id="step4" class="dashboard-card rounded-2xl p-8 shadow-2xl mb-8 hidden">
                <h2 class="text-3xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-check-circle text-green-600 mr-3"></i>Review & Generate Dashboard
                </h2>
                <div id="reviewSummary" class="bg-gray-50 rounded-lg p-6 mb-6">
                    <!-- Summary will be populated by JavaScript -->
                </div>
                <div class="flex justify-between mt-8">
                    <button type="button" onclick="prevStep(4)" class="bg-gray-500 hover:bg-gray-600 text-white px-8 py-3 rounded-lg font-semibold transition duration-200">
                        <i class="fas fa-arrow-left mr-2"></i>Previous
                    </button>
                    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-8 py-3 rounded-lg font-semibold transition duration-200">
                        <i class="fas fa-rocket mr-2"></i>Generate Dashboard
                    </button>
                </div>
            </div>
            </form>
        </div>
    </div>

    <!-- Add the missing JavaScript functions -->
    <script>
        let currentStep = 1;
        let extractedData = {};

        // Wizard navigation functions
        function nextStep(step) {
            if (validateStep(step)) {
                document.getElementById(`step${step}`).classList.add('hidden');
                document.getElementById(`step${step + 1}`).classList.remove('hidden');

                // Update step indicators
                document.getElementById(`step${step}-indicator`).classList.remove('step-active');
                document.getElementById(`step${step}-indicator`).classList.add('step-completed');
                document.getElementById(`step${step + 1}-indicator`).classList.add('step-active');

                currentStep = step + 1;

                if (step === 3) {
                    generateReviewSummary();
                }
            }
        }

        function prevStep(step) {
            document.getElementById(`step${step}`).classList.add('hidden');
            document.getElementById(`step${step - 1}`).classList.remove('hidden');

            // Update step indicators
            document.getElementById(`step${step}-indicator`).classList.remove('step-active');
            document.getElementById(`step${step - 1}-indicator`).classList.add('step-active');
            document.getElementById(`step${step - 1}-indicator`).classList.remove('step-completed');

            currentStep = step - 1;
        }

        function validateStep(step) {
            // Basic validation - ensure required fields are filled
            if (step === 1) {
                const vesselName = document.getElementById('vesselName').value.trim();
                const shippingLine = document.getElementById('shippingLine').value;
                const vesselType = document.getElementById('vesselType').value;
                if (!vesselName || !shippingLine || !vesselType) {
                    alert('Please fill in the vessel name, shipping line, and vessel type.');
                    return false;
                }
            }
            return true;
        }

        // Wizard file upload functions
        function handleWizardFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Show upload status
            document.getElementById('wizardUploadStatus').classList.remove('hidden');
            document.getElementById('wizardUploadSuccess').classList.add('hidden');
            document.getElementById('wizardUploadError').classList.add('hidden');

            // Create FormData and upload file
            const formData = new FormData();
            formData.append('file', file);

            fetch('/api/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    return fetch('/api/extract', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            file_path: data.file_path
                        })
                    });
                } else {
                    throw new Error(data.error || 'Upload failed');
                }
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('wizardUploadStatus').classList.add('hidden');
                if (data.success) {
                    document.getElementById('wizardUploadSuccess').classList.remove('hidden');
                    console.log('Document processed successfully:', data.parsed_data);

                    // Auto-populate form fields with extracted data
                    populateFormFields(data.parsed_data);

                    // Store extracted data globally
                    extractedData = data.parsed_data;
                } else {
                    throw new Error(data.error || 'Extraction failed');
                }
            })
            .catch(error => {
                document.getElementById('wizardUploadStatus').classList.add('hidden');
                document.getElementById('wizardUploadError').classList.remove('hidden');
                document.getElementById('wizardUploadErrorText').textContent = 'Error processing document: ' + error.message;
                console.error('Error:', error);
            });
        }

        function populateFormFields(data) {
            // Populate Step 1 fields
            if (data.vesselName) document.getElementById('vesselName').value = data.vesselName;
            if (data.vesselType) document.getElementById('vesselType').value = data.vesselType;
            if (data.port) document.getElementById('port').value = data.port;
            if (data.company) document.getElementById('company').value = data.company;
            if (data.operationType) document.getElementById('operationType').value = data.operationType;
            if (data.operationDate) document.getElementById('operationDate').value = data.operationDate;
            if (data.berth) document.getElementById('berth').value = data.berth;
            if (data.shiftStart) document.getElementById('shiftStart').value = data.shiftStart;
            if (data.shiftEnd) document.getElementById('shiftEnd').value = data.shiftEnd;

            // Populate Step 2 fields
            if (data.autoOperationsLead) document.getElementById('autoOpsLead').value = data.autoOperationsLead;
            if (data.autoOperationsAssistant) document.getElementById('autoOpsAssistant').value = data.autoOperationsAssistant;
            if (data.heavyHeavyLead) document.getElementById('heavyOpsLead').value = data.heavyHeavyLead;
            if (data.heavyHeavyAssistant) document.getElementById('heavyOpsAssistant').value = data.heavyHeavyAssistant;
            if (data.operationManager) document.getElementById('operationManager').value = data.operationManager;

            // Populate Step 3 fields
            if (data.totalAutos) document.getElementById('totalAutos').value = data.totalAutos;
            if (data.totalHeavy) document.getElementById('totalHeavy').value = data.totalHeavy;
            if (data.cargoType) document.getElementById('cargoType').value = data.cargoType;

            // Show success message briefly
            setTimeout(() => {
                document.getElementById('wizardUploadSuccess').classList.add('hidden');
            }, 5000);
        }

        // File upload functions
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Show upload status
            document.getElementById('uploadStatus').classList.remove('hidden');
            document.getElementById('uploadSuccess').classList.add('hidden');
            document.getElementById('uploadError').classList.add('hidden');

            // Create FormData and upload file
            const formData = new FormData();
            formData.append('file', file);

            fetch('/api/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    return fetch('/api/extract', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            file_path: data.file_path
                        })
                    });
                } else {
                    throw new Error(data.error || 'Upload failed');
                }
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('uploadStatus').classList.add('hidden');

                if (data.success) {
                    document.getElementById('uploadSuccess').classList.remove('hidden');
                    extractedData = data.parsed_data;

                    // Debug logging
                    console.log('Extraction successful!');
                    console.log('Parsed data:', data.parsed_data);
                    console.log('Debug info:', data.debug_info);

                    // Show debug info to user
                    if (Object.keys(data.parsed_data).length === 0) {
                        alert(`No data extracted from document. 
Text length: ${data.debug_info?.text_length || 'unknown'}
First 200 chars: ${data.debug_info?.first_200_chars || 'N/A'}

This might indicate the document format is not recognized. Please check the console for more details.`);
                    }

                    populateFormFields(data.parsed_data);
                } else {
                    throw new Error(data.error || 'Extraction failed');
                }
            })
            .catch(error => {
                document.getElementById('uploadStatus').classList.add('hidden');
                document.getElementById('uploadError').classList.remove('hidden');
                document.getElementById('errorText').textContent = error.message;
                console.error('Error:', error);
            });
        }

        function populateFormFields(data) {
            console.log('Populating form fields with data:', data);

            // Helper function to safely set field values
            function safeSetValue(fieldId, value) {
                const field = document.getElementById(fieldId);
                if (field && value !== undefined && value !== null && value !== '') {
                    const originalValue = field.value;
                    field.value = value;
                    console.log(`Set ${fieldId}: '${originalValue}' -> '${value}'}`);

                    // Trigger change event for any listeners
                    field.dispatchEvent(new Event('change'));
                } else if (!field) {
                    console.warn(`Field with ID '${fieldId}' not found`);
                } else {
                    console.log(`Skipping ${fieldId} - no value provided (${value})`);
                }
            }

            // Helper function to safely set select values
            function safeSetSelect(fieldId, value) {
                const field = document.getElementById(fieldId);
                if (field && value !== undefined && value !== null && value !== '') {
                    // Try exact match first
                    const options = Array.from(field.options);
                    let matchFound = false;

                    for (let option of options) {
                        if (option.value === value || option.text === value) {
                            field.value = option.value;
                            matchFound = true;
                            console.log(`Set select ${fieldId}: '${value}' (exact match)`);
                            break;
                        }
                    }

                    // Try partial match for berth numbers
                    if (!matchFound && fieldId === 'berthLocation') {
                        for (let option of options) {
                            if (option.value.includes('Berth') && value.includes(option.value.replace('Berth ', ''))) {
                                field.value = option.value;
                                matchFound = true;
                                console.log(`Set select ${fieldId}: '${value}' (partial match)`);
                                break;
                            }
                        }
                    }

                    if (!matchFound) {
                        console.warn(`Could not match ${fieldId}:`, value, 'Available options:', options.map(o => `${o.value}:${o.text}`));
                    }

                    // Trigger change event
                    field.dispatchEvent(new Event('change'));
                } else if (!field) {
                    console.warn(`Select field with ID '${fieldId}' not found`);
                }
            }

            // Populate Step 1 fields
            safeSetValue('vesselName', data.vesselName);
            safeSetSelect('vesselType', data.vesselType);
            safeSetValue('port', data.port);
            safeSetValue('operationDate', data.operationDate);
            safeSetValue('company', data.company);
            safeSetSelect('operationType', data.operationType);

            // Team assignments
            safeSetValue('autoOpsLead', data.autoOperationsLead);
            safeSetValue('autoOpsAssistant', data.autoOperationsAssistant);
            safeSetValue('heavyOpsLead', data.heavyHeavyLead);
            safeSetValue('heavyOpsAssistant', data.heavyHeavyAssistant);

            // Berth location - try multiple possible field names
            const berthValue = data.berthLocation || data.berth || data.berthAssignment;
            if (berthValue) {
                console.log('Setting berth location:', berthValue);
                safeSetSelect('berthLocation', berthValue);
            }
            safeSetValue('operationManager', data.operationManager);

            // Populate Step 2 fields - use multiple possible field names
            safeSetValue('totalAutomobiles', data.totalAutomobilesDischarge || data.totalAutomobiles || data.automobiles);
            safeSetValue('heavyEquipment', data.heavyEquipmentDischarge || data.heavyEquipment);
            safeSetValue('brvTarget', data.brvTarget);
            safeSetValue('souTarget', data.souTarget);

            // Zone fields
            safeSetValue('zoneAVehicles', data.zoneA || data.zoneAVehicles);
            safeSetValue('zoneADescription', data.zoneADescription);
            safeSetValue('zoneBVehicles', data.zoneB || data.zoneBVehicles);
            safeSetValue('zoneBDescription', data.zoneBDescription);
            safeSetValue('zoneCVehicles', data.zoneC || data.zoneCVehicles);
            safeSetValue('zoneCDescription', data.zoneCDescription);

            // Populate Step 3 fields
            safeSetValue('expectedRate', data.expectedRate);
            safeSetValue('totalDrivers', data.totalDrivers);
            safeSetValue('shiftStart', data.shiftStart);
            safeSetValue('shiftEnd', data.shiftEnd);
            safeSetValue('breakDuration', data.breakDuration);

            // Vehicle counts
            if (data.numVans) {
                safeSetValue('numVans', data.numVans);
                generateVehicleIdFields();
            }
            if (data.numStationWagons) {
                safeSetValue('numStationWagons', data.numStationWagons);
                generateVehicleIdFields();
            }

            // Populate ZEE fields
            safeSetValue('zeeTarget', data.zeeTarget);
            safeSetValue('zeeAutomobiles', data.zeeAutomobiles);
            safeSetValue('zeeHeavyEquipment', data.zeeHeavyEquipment);
            safeSetValue('zeeElectricVehicles', data.zeeElectricVehicles);
            safeSetValue('zeeStaticCargo', data.zeeStaticCargo);
            safeSetValue('zeeCargoType', data.zeeCargoType);
            safeSetValue('zeeCargoValue', data.zeeCargoValue);
            safeSetSelect('zeePriority', data.zeePriority);

            console.log('Form population completed');
        }

        function updateFormField(fieldId, value) {
            const field = document.getElementById(fieldId);
            if (field) {
                field.value = value;
                console.log(`Updated ${fieldId} with value:`, value);
            } else {
                console.log(`Field with ID '${fieldId}' not found`);
            }
        }

        function updateCargoConfiguration() {
            const shippingLine = document.getElementById('shippingLine').value;
            const vesselType = document.getElementById('vesselType').value;
            const klineConfig = document.getElementById('klineConfiguration');
            const singleTerminalConfig = document.getElementById('singleTerminalConfiguration');

            // Hide all configurations first
            klineConfig.classList.add('hidden');
            singleTerminalConfig.classList.add('hidden');

            // Hide/show vessel type specific fields
            const autoOnlyFields = document.querySelectorAll('.auto-only-field');
            const heavyOnlyFields = document.querySelectorAll('.heavy-only-field');
            const autoHeavyFields = document.querySelectorAll('.auto-heavy-field');

            // Hide all fields first
            autoOnlyFields.forEach(field => field.style.display = 'none');
            heavyOnlyFields.forEach(field => field.style.display = 'none');
            autoHeavyFields.forEach(field => field.style.display = 'none');

            // Show appropriate configuration based on shipping line
            if (shippingLine === 'K-Line') {
                klineConfig.classList.remove('hidden');
            } else if (shippingLine === 'Glovis' || shippingLine === 'MOL' || shippingLine === 'Grimaldi') {
                singleTerminalConfig.classList.remove('hidden');
            }

            // Show fields based on vessel type
            if (vesselType === 'Auto Only') {
                autoOnlyFields.forEach(field => field.style.display = 'block');
            } else if (vesselType === 'Heavy Only') {
                heavyOnlyFields.forEach(field => field.style.display = 'block');
            } else if (vesselType === 'Auto + Heavy') {
                autoHeavyFields.forEach(field => field.style.display = 'block');
            }
        }

        function generateVehicleIdFields() {
            const numVans = parseInt(document.getElementById('numVans').value) || 0;
            const numWagons = parseInt(document.getElementById('numStationWagons').value) || 0;
            const container = document.getElementById('vehicleIdFields');

            let html = '';

            if (numVans > 0 || numWagons > 0) {
                html += '<h4 class="text-lg font-semibold text-gray-800 mb-4">Vehicle ID Numbers</h4>';
                html += '<div class="grid md:grid-cols-2 gap-4">';

                // Van IDs
                for (let i = 1; i <= numVans; i++) {
                    html += `
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Van ${i} ID</label>
                            <input type="text" id="vanId${i}" class="w-full px-3 py-2 rounded border border-gray-300 focus:ring-2 focus:ring-blue-500" placeholder="e.g., V${i}">
                        </div>
                    `;
                }

                // Station Wagon IDs
                for (let i = 1; i <= numWagons; i++) {
                    html += `
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Station Wagon ${i} ID</label>
                            <input type="text" id="wagonId${i}" class="w-full px-3 py-2 rounded border border-gray-300 focus:ring-2 focus:ring-blue-500" placeholder="e.g., SW${i}">
                        </div>
                    `;
                }

                html += '</div>';
            }

            container.innerHTML = html;
        }

        function generateReviewSummary() {
            const vesselName = document.getElementById('vesselName').value || 'Not specified';
            const vesselType = document.getElementById('vesselType').value || 'Not specified';
            const totalAutos = document.getElementById('totalAutomobiles').value || '0';
            const heavyEquip = document.getElementById('heavyEquipment').value || '0';
            const expectedRate = document.getElementById('expectedRate').value || 'Not specified';

            const summaryHtml = `
                <h3 class="text-xl font-bold mb-4">Operation Summary</h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <p><strong>Vessel:</strong> ${vesselName}</p>
                        <p><strong>Type:</strong> ${vesselType}</p>
                        <p><strong>Total Automobiles:</strong> ${totalAutos}</p>
                    </div>
                    <div>
                        <p><strong>Heavy Equipment:</strong> ${heavyEquip}</p>
                        <p><strong>Expected Rate:</strong> ${expectedRate} cars/hour</p>
                        <p><strong>Port:</strong> ${document.getElementById('port').value || 'Not specified'}</p>
                    </div>
                </div>
            `;

            document.getElementById('reviewSummary').innerHTML = summaryHtml;
        }

        function generateDashboard() {
            // Hide wizard and show dashboard
            document.getElementById('wizardInterface').classList.add('hidden');
            document.getElementById('dashboardInterface').classList.remove('hidden');

            // Populate dashboard with form data
            populateDashboard();
        }

        function populateDashboard() {
            // This would populate the dashboard with the collected data
            // For now, redirect to the master dashboard
            window.location.href = '/master';
        }

        function showWizard() {
            document.getElementById('dashboardInterface').classList.add('hidden');
            document.getElementById('wizardInterface').classList.remove('hidden');
        }

        // Set default date to today
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('operationDate').value = today;
        });

        function addVehicleType(facility) {
            const containerId = `${facility}VehicleTypeContainer`;
            const container = document.getElementById(containerId);
            const index = container.children.length;

            const newDiv = document.createElement('div');
            newDiv.className = "grid grid-cols-3 gap-4 mb-4";
            newDiv.innerHTML = `
                <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2">Vehicle Type</label>
                    <input type="text" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="${facility}VehicleType${index}" name="${facility}VehicleType${index}" placeholder="e.g., Sedan">
                </div>
                <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2">Quantity</label>
                    <input type="number" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="${facility}VehicleQuantity${index}" name="${facility}VehicleQuantity${index}" placeholder="e.g., 100" onchange="validate${facility.charAt(0).toUpperCase() + facility.slice(1)}Totals()">
                </div>
                <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2">Location</label>
                    <input type="text" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="${facility}VehicleLocation${index}" name="${facility}VehicleLocation${index}" placeholder="e.g., North Terminal">
                </div>
            `;
            container.appendChild(newDiv);
        }

        function toggleElectricQuantity(facility, show) {
            const quantityField = document.getElementById(`${facility}TotalElectric`) || document.getElementById(`${facility}ElectricVehicles`);
            if (quantityField) {
                quantityField.style.display = show ? 'block' : 'none';
                if (!show) {
                    quantityField.value = '';
                }
            }
        }

        function getVehicleTypeData(facility) {
            const container = document.getElementById(`${facility}VehicleTypeContainer`);
            const vehicleTypes = [];
            for (let i = 0; i < container.children.length; i++) {
                const type = document.getElementById(`${facility}VehicleType${i}`).value;
                const quantity = parseInt(document.getElementById(`${facility}VehicleQuantity${i}`).value) || 0;
                vehicleTypes.push({ type, quantity });
            }
            return vehicleTypes;
        }

        function validateBrvTotals() {
            const totalAutos = parseInt(document.getElementById('brvAutomobiles').value) || 0;
            let vehicleTypeSum = 0;
            const vehicleTypeContainer = document.getElementById('brvVehicleTypeContainer');

            for (let i = 0; i < vehicleTypeContainer.children.length; i++) {
                const quantityInput = document.getElementById(`brvVehicleQuantity${i}`);
                const quantity = parseInt(quantityInput.value) || 0;
                vehicleTypeSum += quantity;
            }

            if (vehicleTypeSum !== totalAutos) {
                alert(`Total quantity of vehicle types in BRV must equal total autos: ${totalAutos}`);
            }
        }

        function validateTerminalTotals() {
            const totalAutos = parseInt(document.getElementById('terminalAutomobiles').value) || 0;
            let vehicleTypeSum = 0;
            const vehicleTypeContainer = document.getElementById('terminalVehicleTypeContainer');

            for (let i = 0; i < vehicleTypeContainer.children.length; i++) {
                const quantityInput = document.getElementById(`terminalVehicleQuantity${i}`);
                const quantity = parseInt(quantityInput.value) || 0;
                vehicleTypeSum += quantity;
            }

            if (vehicleTypeSum !== totalAutos) {
                alert(`Total quantity of vehicle types in Terminal must equal total autos: ${totalAutos}`);
            }
        }
        // Handle form submission
        document.getElementById('operationForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            // Show processing state
            const submitBtn = document.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Generating Dashboard...';
            submitBtn.disabled = true;

            // Collect form data properly
            const data = {};
            
            // Step 1: Vessel Information
            data.vesselName = document.getElementById('vesselName').value || '';
            data.shippingLine = document.getElementById('shippingLine').value || '';
            data.vesselType = document.getElementById('vesselType').value || '';
            data.port = document.getElementById('port').value || '';
            data.operationDate = document.getElementById('operationDate').value || '';
            data.company = document.getElementById('company').value || '';
            data.operationType = document.getElementById('operationType').value || '';
            data.berthLocation = document.getElementById('berthLocation').value || '';
            data.operationManager = document.getElementById('operationManager').value || '';
            data.autoOpsLead = document.getElementById('autoOpsLead').value || '';
            data.autoOpsAssistant = document.getElementById('autoOpsAssistant').value || '';
            data.heavyOpsLead = document.getElementById('heavyOpsLead').value || '';
            data.heavyOpsAssistant = document.getElementById('heavyOpsAssistant').value || '';

            // Step 2: Cargo Configuration - determine configuration type
            const shippingLine = data.shippingLine;

            if (shippingLine === 'K-Line') {
                // K-Line: Collect from BRV, ZEE, SOU
                const brvAutos = parseInt(document.getElementById('brvAutomobiles')?.value) || 0;
                const brvHeavy = parseInt(document.getElementById('brvHeavyEquipment')?.value) || 0;
                const brvElectric = parseInt(document.getElementById('brvTotalElectric')?.value) || 0;
                
                const zeeAutos = parseInt(document.getElementById('zeeTotalAutos')?.value) || 0;
                const zeeHeavy = parseInt(document.getElementById('zeeTotalHeavy')?.value) || 0;
                const zeeElectric = parseInt(document.getElementById('zeeElectricVehicles')?.value) || 0;
                
                const souAutos = parseInt(document.getElementById('souTotalAutos')?.value) || 0;
                const souHeavy = parseInt(document.getElementById('souHeavyEquipment')?.value) || 0;
                const souElectric = parseInt(document.getElementById('souTotalElectric')?.value) || 0;

                data.totalAutomobilesDischarge = brvAutos + zeeAutos + souAutos;
                data.heavyEquipmentDischarge = brvHeavy + zeeHeavy + souHeavy;
                data.totalElectricVehicles = brvElectric + zeeElectric + souElectric;
                data.brvTarget = brvAutos + brvHeavy + brvElectric;
                data.zeeTarget = zeeAutos + zeeHeavy + zeeElectric;
                data.souTarget = souAutos + souHeavy + souElectric;
            } else {
                // Single Terminal: Glovis, MOL, Grimaldi
                const terminalAutos = parseInt(document.getElementById('terminalAutomobiles')?.value) || 0;
                const terminalHeavy = parseInt(document.getElementById('terminalHeavyEquipment')?.value) || 0;
                const terminalElectric = parseInt(document.getElementById('terminalElectricVehicles')?.value) || 0;
                const terminalStatic = parseInt(document.getElementById('terminalStaticCargo')?.value) || 0;

                data.totalAutomobilesDischarge = terminalAutos;
                data.heavyEquipmentDischarge = terminalHeavy;
                data.totalElectricVehicles = terminalElectric;
                data.totalStaticCargo = terminalStatic;
                data.brvTarget = 0;
                data.zeeTarget = 0;
                data.souTarget = terminalAutos + terminalHeavy + terminalElectric + terminalStatic;
            }

            // Step 3: Operational Parameters
            data.expectedRate = parseFloat(document.getElementById('expectedRate')?.value) || 0;
            data.totalDrivers = parseInt(document.getElementById('totalDrivers')?.value) || 0;
            data.shiftStart = document.getElementById('shiftStart')?.value || '';
            data.shiftEnd = document.getElementById('shiftEnd')?.value || '';
            data.breakDuration = parseInt(document.getElementById('breakDuration')?.value) || 0;
            data.targetCompletion = document.getElementById('targetCompletion')?.value || '';
            data.ticoVans = parseInt(document.getElementById('numVans')?.value) || 0;
            data.ticoStationWagons = parseInt(document.getElementById('numStationWagons')?.value) || 0;

            // Calculate total vehicles
            data.totalVehicles = (data.totalAutomobilesDischarge || 0) + (data.heavyEquipmentDischarge || 0) + (data.totalElectricVehicles || 0);

            console.log('Submitting data:', data);

            try {
                const response = await fetch('/api/ships', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    const result = await response.json();
                    alert('Ship operation created successfully!');
                    window.location.href = `/ship-info?ship=${result.id}`;
                } else {
                    const error = await response.json();
                    alert('Error creating ship operation: ' + (error.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error creating operation:', error);
                alert('Error creating operation: ' + error.message);
            } finally {
                // Reset button
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        });
    </script>

    <!-- Generated Dashboard -->
    <div id="dashboardInterface" class="dashboard-container hidden">
        <div class="container mx-auto px-4 py-8">
            <!-- Dashboard Header -->
            <div id="dashboardHeader" class="text-center mb-8 p-6 dashboard-card rounded-2xl shadow-2xl">
                                <!-- Will be populated by JavaScript -->
            </div>

            <!-- Dashboard Controls -->
            <div class="dashboard-card rounded-2xl p-6 shadow-2xl mb-8">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-800 flex items-center">
                        <i class="fas fa-sliders-h text-blue-600 mr-2"></i>Real-time Updates
                    </h3>
                    <button onclick="showWizard()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-semibold transition duration-200">
                        <i class="fas fa-plus mr-2"></i>New Operation
                    </button>
                </div>
                <div class="grid md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Discharged</label>
                        <input type="number" id="currentDischarged" class="w-full px-4 py-3 rounded border focus:ring-2 focus:ring-blue-500" onchange="updateProgress()">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Loaded</label>
                        <input type="number" id="currentLoaded" class="w-full px-4 py-3 rounded border focus:ring-2 focus:ring-blue-500" onchange="updateProgress()">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Heavy Equipment</label>
                        <input type="number" id="currentHeavy" class="w-full px-4 py-3 rounded border focus:ring-2 focus:ring-blue-500" onchange="updateProgress()">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Active Drivers</label>
                        <input type="number" id="activeDrivers" class="w-full px-4 py-3 rounded border focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
            </div>

            <!-- KPI Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="kpi-card dashboard-card rounded-2xl p-6 shadow-2xl text-center">
                    <div class="text-3xl font-bold text-blue-600" id="dischargeProgress">0%</div>
                    <div class="text-gray-600">Discharge Progress</div>
                </div>
                <div class="kpi-card dashboard-card rounded-2xl p-6 shadow-2xl text-center">
                    <div class="text-3xl font-bold text-green-600" id="loadingProgress">0%</div>
                    <div class="text-gray-600">Loading Progress</div>
                </div>
                <div class="kpi-card dashboard-card rounded-2xl p-6 shadow-2xl text-center">
                    <div class="text-3xl font-bold text-purple-600" id="currentRate">0</div>
                    <div class="text-gray-600">Current Rate (cars/hr)</div>
                </div>
                <div class="kpi-card dashboard-card rounded-2xl p-6 shadow-2xl text-center">
                    <div class="text-3xl font-bold text-orange-600" id="eta">--:--</div>
                    <div class="text-gray-600">Estimated Completion</div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="dashboard-card rounded-2xl p-6 shadow-2xl mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Quick Actions</h3>
                <div class="grid md:grid-cols-4 gap-4">
                    <button onclick="window.location.href='/master'" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition duration-200">
                        <i class="fas fa-tachometer-alt mr-2"></i>Master Dashboard
                    </button>
                    <button onclick="window.location.href='/calendar'" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold transition duration-200">
                        <i class="fas fa-calendar mr-2"></i>Calendar View
                    </button>
                    <button onclick="window.location.href='/analytics'" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-semibold transition duration-200">
                        <i class="fas fa-chart-bar mr-2"></i>Analytics
                    </button>
                    <button onclick="downloadProject()" class="bg-orange-600 hover:bg-orange-700 text-white px-6 py-3 rounded-lg font-semibold transition duration-200">
                        <i class="fas fa-download mr-2"></i>Download Project
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function updateProgress() {
            // This function would update the progress indicators
            // Based on the input values
            const discharged = parseInt(document.getElementById('currentDischarged').value) || 0;
            const total = parseInt(document.getElementById('totalAutomobiles').value) || 1;
            const progress = Math.min((discharged / total) * 100, 100);

            document.getElementById('dischargeProgress').textContent = progress.toFixed(1) + '%';
        }

        async function downloadProject() {
            try {
                // Show loading state
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Creating Download...';
                button.disabled = true;

                // Create the download package
                const response = await fetch('/create-download');
                const result = await response.json();

                if (result.success) {
                    // Redirect to download URL
                    window.open(result.download_url, '_blank');

                    // Show success message
                    alert(' Project packaged successfully! Download should start automatically.');
                } else {
                    alert(' Failed to create download package: ' + result.message);
                }

                // Restore button
                button.innerHTML = originalText;
                button.disabled = false;

            } catch (error) {
                console.error('Download error:', error);
                alert(' Error creating download package. Please try again.');

                // Restore button
                const button = event.target;
                button.innerHTML = '<i class="fas fa-download mr-2"></i>Download Project';
                button.disabled = false;
            }
        }
    </script>
</body>
</html>